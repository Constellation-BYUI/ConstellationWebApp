@model ConstellationWebApp.Models.ViewModel
@using System.Security.Claims;

@{
    ViewData["Title"] = "Job and Postings Index";
    var currentUser = this.User.FindFirstValue(ClaimTypes.NameIdentifier);
}
<link rel="stylesheet" href="/css/postings-index.css" />

<!-- Page info -->
<section class="page-info">
    <div class="info-button" id="button-info">View&nbsp;Page&nbsp;Info</div>
    <article>
        View all the postings currently listed on the platform. If you need to make a posting, click the create button.
        If you want to see more details about a posting, click the details button. When you own postings you can edit and delete them from this page.
    </article>
</section>
<!-- #endregion -->
<!-- The Postings index container -->
<div class="posting-index-container">
    <div class="posting-index-bread-crumb">Home > Postings</div>
    <!-- search Bars -->
    <div class="general-search-bars">
        <!-- Create Job Postings button -->
        <a asp-action="Create"><div class="create-posting btn btn-md btn-success">Create&nbsp;Job&nbsp;Posting</div></a>
        <form action="" class="search-bar0">
            <div class="input-group">
                <input type="search" placeholder="Search.." aria-describedby="button-addon5" class="form-control" style="width: 100px">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </form>
        <form asp-action="Index" asp-controller="Postings" class="search-bar1">
            <div class="input-group">
                <input type="search" name="titleSearch" placeholder="Search by title.." aria-describedby="button-addon5" class="form-control" style="width: 100px">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </form>
        <form asp-action="Index" asp-controller="Postings" class="search-bar2">
            <div class="input-group">
                <input list="postingTypes-List" name="typeSearch" placeholder="Seach by a posting type.." aria-describedby="button-addon5" class="form-control" style="width: 100px">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </form>
        <form asp-action="Index" asp-controller="Postings" class="search-bar3">
            <div class="input-group">
                <input type="search" name="postingBySearch" placeholder="Search by posting Owner.." aria-describedby="button-addon5" class="form-control" style="width: 100px">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </form>
    </div>

    <!-- Postings contents goes in here -->
    <div class="general-index-head"><h2>Job Postings</h2></div>
    <div class="posting-index-content">
        <datalist id="postingTypes-List">
            @{
                List<ConstellationWebApp.Models.PostingType> postingTypes = Model.PostingTypes.ToList();

                foreach (var postingType in postingTypes)
                {
                    <option value="@postingType.PostingTypeName" data-id="@postingType.PostingTypeName"></option>
                }
            @:</datalist>
            }

            @{
                foreach (var item in Model.Postings)
                {
                    var photoPath = "";
                    if (item.PostingOwner.PhotoPath != null)
                    {
                        photoPath = "~/image/" + item.PostingOwner.PhotoPath;
                    }
                    else
                    {
                        photoPath = "~/WebAssests/siteImages/avataricon.png";
                    }

                    var collabMemberPath = "../Users/Details/" + (item.PostingOwner.Id);

                    <div class="card shadow-lg mb-3">
                        @*Name of Company*@
                        <h3 class="card-header bg-primary py-1 text-white text-center m-0">
                            @Html.DisplayFor(modelItem => item.PostingFor)
                        </h3>
                        @*Position*@
                        <h5 class="text-center m-0 bg-light p-2 border-bottom">
                            <strong class="text-success">Position : </strong><span class="mb-0 p-1 text-black">@Html.DisplayFor(modelItem => item.PostingTitle)</span>
                        </h5>

                        <section class="bg-light text-wrap text-justify">
                            @*Owner of Job Posting's Image*@
                            <div class="col-6 text-left float-left">
                                <div class="bg-light text-wrap p-2 py-0 border-bottom"><strong class="text-black">Recruiter's Name : </strong><span class="text-black-50">@Html.DisplayFor(modelItem => item.PostingOwner.UserName)</span></div>
                                <a class="m-1 border-success" href="@collabMemberPath"><img class="poster-image shadow-lg" src=" @photoPath" alt="@Html.DisplayFor(modelItem => item.PostingOwner.UserName)" asp-append-version="true" /></a>
                            </div>
                            <div class="col-6 float-right text-center">
                                @*Type of Posting*@
                                <h5 class="card-title bg-info container-fluid float-right py-2 text-white rounded mt-2">Type of Posting</h5>
                                @foreach (var type in item.Posting_PostingTypes)
                                {
                                    <h6 class="text-black">
                                        @type.PostingTypes.PostingTypeName
                                    </h6>

                                }
                                @*Description of Posting*@
                                <h5 class="card-title bg-info container-fluid float-right py-2 text-white rounded">Description</h5>
                                <p class="text-black-50 p-2 user-bio">@Html.DisplayFor(modelItem => item.Description)</p>
                            </div>
                        </section>

                        <section class="card-footer text-left">
                            @if ((currentUser == item.PostingOwner.Id) && (currentUser != null))
                            {

                                <a class="btn btn-sm btn-primary" asp-action="Edit" asp-route-id="@item.PostingID">Edit</a>
                                <a class="btn btn-sm btn-secondary" asp-action="Details" asp-route-id="@item.PostingID">Details</a>
                                <a class="btn btn-sm btn-danger" asp-action="Delete" asp-route-id="@item.PostingID">Delete</a>
                                        }
                                        else
                                        {
                                            <a class="btn btn-sm btn-secondary" asp-action="Details" asp-route-id="@item.PostingID">Details</a>
                                        }
                                    </section>
                                </div>
                            }
                }
        </div>
    </div>
